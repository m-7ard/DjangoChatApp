{% extends "core/header.html" %}
{% load static %}
{% load custom_tags %}

{% block extrahead %}
<link rel="stylesheet" type="text/css" href="{% static 'rooms/app.css' %}">
{% endblock %}

{% block content %}
<div class="app">
	<div class="app__sidebar app__sidebar--secondary">
		<div class="container container--fill">
			<div class="container__header">
				Friends
			</div>
			<div class="container__subheader has-shadow">
				<span class="icon icon--small">
					<i class="material-symbols-outlined">
						search
					</i>
				</span>
				<span class="wrapper--remaining-space">
					<input type="text" class="container__search">
				</span>
				<span class="icon icon--small">
					<i class="material-symbols-outlined">
						patient_list
					</i>
				</span>
				<span class="icon icon--small">
					<i class="material-symbols-outlined">
						person_add
					</i>
				</span>
			</div>
			<div class="wrapper--remaining-space">
				<ul class="container__content">
					<ul data-friendship="pending">
						<li class="container__label secondary-text secondary-text--small">
							Incoming Friend Requests
						</li>
						{% for friendship in user.profile.friendships.pending %}
							{% with user|get_friendship_friend:friendship as friend %}
							<li class="modelbox modelbox--hoverable">
								<span class="avatar avatar--small has-shadow">
									<img src="{{ MEDIA_URL }}{{ friend.profile.image.url }}" alt="">
								</span>
								<span class="wrapper--remaining-space">
									<div class="modelbox__info">
										<div class="primary-text primary-text--small ellipsis {{ friend.profile.status }}-color--primary">
											{{ friend.username }}
										</div>
										<div class="secondary-text secondary-text--small ellipsis {{ friend.profile.status }}-color--secondary">
											{{ friend.profile.status }}
										</div>
									</div>
								</span>
								<span class="friendship align-center" data-pk="{{ friendship.pk }}">
									<span class="icon icon__hoverable icon--small offline-color--primary" data-command="manage_friendship" data-kind="accept">
										<i class="material-symbols-outlined">
											task_alt
										</i>
									</span>
									<span class="icon icon__hoverable icon--small offline-color--primary" data-command="manage_friendship" data-kind="reject">
										<i class="material-symbols-outlined">
											cancel
										</i>
									</span>
								</span>
							</li>	
							{% endwith %}
						{% endfor %}
					</ul>
					<ul data-friendship="all">
						<li class="container__label secondary-text secondary-text--small">
							All Friends
						</li>
						{% for friendship in user.profile.friendships.accepted %}
							{% with user|get_friendship_friend:friendship as friend %}
								<li class="modelbox modelbox--hoverable">
									<span class="avatar avatar--small has-shadow">
										<img src="{{ MEDIA_URL }}{{ friend.profile.image.url }}" alt="">
									</span>
									<span class="wrapper--remaining-space">
										<div class="modelbox__info">
											<div class="primary-text primary-text--small ellipsis {{ friend.profile.status }}-color--primary">
												{{ friend.username }}
											</div>
											<div class="secondary-text secondary-text--small ellipsis {{ friend.profile.status }}-color--secondary">
												{{ friend.profile.status }}
											</div>
										</div>
									</span>
									<span class="friendship align-center" data-pk="{{ friendship.pk }}">
										<div class="icon icon__hoverable icon--small offline-color--primary tooltip__trigger" 
										data-positioning='{"top": "100%", "right": "0px"}' 
										data-target=".friendship__menu">
											<i class="material-symbols-outlined">
												expand_more
											</i>
										</div>
									</span>
								</li>
							{% endwith %}
						{% endfor %}
						
					</ul>
				</ul>
			</div>
		</div>



		<div class="container container--fill">
			<div class="container__header has-shadow">
				Events
			</div>
			<div class="wrapper--remaining-space">
				<div class="container__content">
					<div class="">

					</div>
				</div>
			</div>
		</div>
		<div class="container container--fill">
			<div class="container__header">
					Groups			
			</div>
			<div class="container__subheader has-shadow">
				<span class="icon icon--small">
					<i class="material-symbols-outlined">
						search
					</i>
				</span>
				<span class="wrapper--remaining-space">
					<input type="text" class="container__search">
				</span>
				<span class="icon icon--small">
					<i class="material-symbols-outlined">
						list_alt_add
					</i>
				</span>
				<span class="icon icon--small">
					<i class="material-symbols-outlined">
						travel_explore
					</i>
				</span>
			</div>
			<div class="wrapper--remaining-space">
				<ul class="container__content">
					{% for membership in user.memberships.all %}
					{% with membership.room as joined_room  %}
					<a class="modelbox modelbox--hoverable" href="{% url 'room' joined_room.pk %}">
						<span class="avatar avatar--medium has-shadow">
							<img src="{{ MEDIA_URL }}{{ joined_room.image.url }}" alt="">
						</span>
						<span class="wrapper--remaining-space">
							<span class="modelbox__info">
								<div class="primary-text primary-text--medium ellipsis online-color--primary">
									{{ joined_room }}
								</div>
								<div class="secondary-text secondary-text--medium ellipsis online-color--secondary">
									{{ joined_room.members.all.count }} Members
								</div>
							</span>
						</span>
					</a>
					{% endwith %}
					{% endfor %}
				</ul>
			</div>
		</div>
	</div>

	<div class="app__main">
		{% block app__main %}{% endblock %}
	</div>

	<div class="app__sidebar app__sidebar--primary">
		{% block app__sidebar--primary %}{% endblock %}
	</div>
</div>
{% endblock %}

{% block tooltips %}

<div class="friendship__menu tooltip tooltip--hidden has-shadow">
	<div class="friendship__action secondary-text secondary-text--small tooltip__close">
		Message Friend
	</div>
	<div class="friendship__action secondary-text secondary-text--small tooltip__close">
		Add Nickname
	</div>
	<div class="friendship__action secondary-text secondary-text--small tooltip__close" data-command="manage_friendship" data-kind="remove">
		Remove Friend
	</div>
</div>

<div class="profile tooltip tooltip--hidden has-shadow" id="member-profile">
	{% include "./elements/member-profile.html" %}
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'js/app.js' %}"></script>
{% endblock %}